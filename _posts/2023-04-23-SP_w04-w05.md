---
layout: post
title: "SP:w04-w05"
categories: [lecture]
---

## 이해하기

ls -l 을 했을 때 보여지는 정보에 대해 생각해 보자.

앞 쪽의 접근 권한이나 소유자, 수정날짜 등은 inode에 저장되어 있다.

inode는 디스크의 i-list에 저장되어 있다.

inode 안에는 진짜 내용이 들어 있는 데이터 블록이 디스크의 어느 위치에 있는지에 대한 정보도 갖고 있다.

모든 파일이 같은 inode라는 템플릿으로 찍어내어 만들어진다고 생각해 보면 inode 블록들의 크기는 모두 같다는 것을 이해할 수 있다.

**그 뒤의 파일의 이름은 부모 디렉토리가 가지고 있다는 것이 중요하다**

부모 디렉토리도 파일이기 때문에 inode 블록을 가지고 있으며, 이 inode 블록에서 저장하고 있는 데이터들은 자신이 가지고 있는 자식 파일들에 대한 정보이다.

부모 디렉토리는 자식 파일들의 이름, inode 번호라는 *데이터*를 가지고 있는 것이다.

그러니 ls -l 의 결과인 파일 이름은 여기서 가져오게 된다.

---

파일의 종류에는 특수파일이 있다.

- character special file
- block special file

각각 접근 권한 맨 앞에 c, b가 붙어 있다. 디렉토리는 d

리눅스는 터미널, 카메라, 프린터 등 각종 IO 장치들도 파일처럼 접근할 수 있게 만들기 위해 이러한 특수파일을 사용한다.

남의 터미널에 rm 명령을 보내든 .. 그런 걸 할 수 있다는 뜻

    tty

위 명령으로 현재 터미널이 어떤 파일인지 알 수 있다.

---

한 프로세스는 하나의 파일 디스크립터 테이블을 가진다.

파일 디스크립터 테이블에는 파일디스크립터(fd)0번부터 n번까지 있다.

n번 이상은 더이상 사용할 수 없어 파일을 열지 못한다.

fd 0 : 표준입력
fd 1 : 표준출력
fd 2 : 표준오류

얘네는 기본 연결되어있다.

    write(2, text, strlen(text));

이거랑

    write(stderr, text, strlen(text));

이거랑 같다는 뜻이다.

그러니까 open으로 파일을 열게 되면 fd3부터 할당받게 되고 이 fd3은 파일테이블을 가리킨다.

파일테이블은 파일을 읽기로 열었는지, 지금 offset 위치는 어디인지, inode는 어디에 있는지의 정보를 갖고 있다.

그러니까 파일테이블은 inode가 메모리에 위치한 주소를 담고 있는 공간이 있다.

이걸 통해서 inode로 접근한다.

inode에는 데이터의 여러가지 특징과 데이터가 디스크의 데이터블록 어디에 저장되어있는지의 정보가 있으니 이것을 참고하여 데이터에 접근하게 된다.

데이터는 흩어져 있을 수 있으니깐

---

lseek 관련하여

읽고 있는 위치, 즉 offset을 변경한다.

그냥 이 함수를 부르기만 하면 변경이 된다.

가령 처음부터 읽으려고 파일을 열면 offset은 0이다.

이 상태에서 lseek를 불러 offset을 SEEK_END 또는 SEEK_SET + 30 이런 식으로 변경하게 되면 읽기 시작하는 위치가 바뀌는 것이다.

근데 이 lseek는 offset 값을 반환하기도 한다. off_t 타입으로!

그러니깐 반환된 값을 통해 파일의 크기 등을 알 수 있을 것이다.

---

remove()는 비어있는 디렉토리 삭제

unlink()는 파일 삭제

비어있지 않은 디렉토리는 안쪽의 파일을 모두 삭제하고 디렉토리를 삭제하는 과정을 거쳐야 한다.